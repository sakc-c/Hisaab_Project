{% extends 'hisaab/base.html' %}
{% load custom_filters %}

{% block content %}
    <!-- Header and Buttons -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Billing</h2>
        <a href="{% url 'create_bill' %}" class="btn btn-success mb-3">
            + New Bill
        </a>
    </div>

    <!-- Search Bar -->
    <div class="d-flex mb-3">
        <input type="text" id="searchInput" class="form-control w-50 me-2" placeholder="Search bill numbers..."
               style="max-width: 300px; border-radius: 20px; padding: 8px;">
    </div>

    <!-- Bill Table -->
    <table class="table table-bordered table-hover" id="billTable">
        <thead>
        <tr>
            <th>Bill ID</th>
            <th>Cashier</th>
            <th>Amount</th>
            <th>Date Created</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for bill in bills %}
            <tr>
                <td>{{ bill.billID }}</td>
                <td>{{ bill.userID.username }}</td>
                <td>${{ bill.totalAmount }}</td>
                <td>{{ bill.createdAt }}</td>
                <td>
                    <button type="button" class="btn btn-sm btn-warning" data-bs-toggle="modal"
                            data-bs-target="#editBillModal{{ bill.billID }}">
                        <i class="bi bi-pencil"></i>
                    </button>
                    {% if request.user|has_group:"h_admin" %}
                        <a href="{% url 'delete_bill' bill.billID %}" class="btn btn-sm btn-danger"
                           onclick="return confirm('Are you sure you want to delete this bill?');">
                            <i class="bi bi-trash"></i>
                        </a>
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="5">No bills found.</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block scripts %}
    <script>
        document.getElementById('searchInput').addEventListener('keyup', function () {
            let searchTerm = this.value.toLowerCase();
            document.querySelectorAll('#billTable tbody tr').forEach(row => {
                let billID = row.cells[0].innerText.toLowerCase();
                row.style.display = billID.includes(searchTerm) ? '' : 'none';
            });
        });
    </script>
{% endblock %}